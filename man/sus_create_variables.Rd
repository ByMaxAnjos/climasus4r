% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/sus_create_variables.R
\name{sus_create_variables}
\alias{sus_create_variables}
\title{Create Derived Variables for Epidemiological Analysis}
\usage{
sus_create_variables(
  df,
  create_age_groups = TRUE,
  age_breaks = c(0, 5, 15, 60, Inf),
  age_labels = NULL,
  create_calendar_vars = TRUE,
  create_climate_vars = TRUE,
  climate_region = NULL,
  date_col = NULL,
  age_col = NULL,
  hemisphere = "south",
  lang = "pt",
  verbose = TRUE
)
}
\arguments{
\item{df}{A data frame containing health data from any SUS system.}

\item{create_age_groups}{Logical. If \code{TRUE}, derives age-based variables.
When enabled, the function will attempt to determine age using the following
hierarchy (in order of preference):
\enumerate{
\item An existing age column supplied via \code{age_col}.
\item Calculation from birth date and event date columns (gold standard).
\item Decoding of DATASUS age code variables (fallback method).
}

If age is successfully determined, the following variables may be created:

\itemize{
\item \strong{User-defined age groups}:
A categorical variable based on \code{age_breaks} and \code{age_labels},
created using \code{cut()}. This variable is always created when
\code{create_age_groups = TRUE}.

\item \strong{Climate risk age group}:
A coarse age classification designed for climate–health analyses,
with three categories:
\describe{
\item{0–4}{High risk}
\item{5–64}{Standard risk}
\item{65+}{High risk}
}
The variable name depends on the selected language:
\itemize{
\item English: \code{climate_risk_group}
\item Portuguese: \code{grupo_risco_climatico}
\item Spanish: \code{grupo_riesgo_climatico}
}

\item \strong{IBGE quinquennial age groups}:
A standardized 17-group age classification following the Brazilian
Institute of Geography and Statistics (IBGE) quinquennial structure:
\code{0–4, 5–9, ..., 75–79, 80+}.
    This variable ensures national and international comparability and is
particularly useful for demographic and epidemiological analyses.
Variable names by language:
\itemize{
\item English: \code{ibge_age_group}
\item Portuguese: \code{faixa_etaria_ibge}
\item Spanish: \code{grupo_edad_ibge}
}
}

All age group variables are created only if age can be reliably determined.
If age cannot be inferred, the function will stop with an informative error.}

\item{age_breaks}{Numeric vector specifying the breakpoints for age groups.
Default is \code{c(0, 5, 15, 65, Inf)} for standard epidemiological categories.}

\item{age_labels}{Character vector with labels for age groups. If \code{NULL}
(default), generates labels automatically from breaks.}

\item{create_calendar_vars}{Logical. If \code{TRUE}, creates calendar variables
(day of week, month, season, etc.). Default is \code{FALSE}.}

\item{create_climate_vars}{Logical. Se \code{TRUE}, cria variaveis climaticas e sazonais.}

\item{climate_region}{Character. Regiao climatica para calculos sazonais.
Opcoes: "norte", "nordeste", "centro-oeste", "sudeste", "sul".}

\item{date_col}{Character string with the name of the date column. If \code{NULL}
(default), auto-detects the date column.}

\item{age_col}{Character string with the name of the age column (in years).
If \code{NULL} (default), auto-detects and calculates age using hierarchical logic:
\enumerate{
\item Direct age column (if exists)
\item Calculate from dates (event_date - birth_date)
\item Decode DATASUS age codes (NU_IDADE_N, IDADE)
}}

\item{hemisphere}{Character string specifying the hemisphere for season
calculation. Options: \code{"south"} (default, for Brazil), \code{"north"}.}

\item{lang}{Character string specifying the language for variable labels and
messages. Options: \code{"en"} (English), \code{"pt"} (Portuguese, default), \code{"es"} (Spanish).}

\item{verbose}{Logical. If \code{TRUE} (default), prints progress messages.}
}
\value{
The input data frame with additional columns for the created variables.
}
\description{
Creates commonly used derived variables from health data across ALL SUS systems
(SIM, SINAN, SIH, SIA, SINASC, CNES), including age groups, calendar variables,
and other epidemiologically relevant categorizations. Features age
calculation that handles different data formats across systems.
}
\details{
\strong{Age Calculation} (Hierarchical Logic):

The function uses a 3-tier hierarchy to ensure age is calculated correctly
across all SUS systems:
\enumerate{
\item \strong{Direct Age Column} (Fastest): If a column with age in years already exists
(common in SIM after microdatasus processing), uses it directly.
\item \strong{Date Calculation} (Gold Standard): If birth date and event date are available,
calculates exact age as: \code{interval(birth_date, event_date) / years(1)}.
This is the most accurate method and works for:
\itemize{
\item SINAN: Has \code{DTNASC} and \code{DT_NOTIFIC}
\item SIH: Has \code{NASC} and \code{DT_INTER}
\item SINASC: Has \code{DTNASC} (mother) and \code{DTNASC} (newborn)
}
\item \strong{DATASUS Code Decoder} (Fallback): If dates are missing (common in anonymized
data), decodes the composite age code used by DATASUS:
\itemize{
\item Codes starting with \code{1}: Hours (converted to 0 years)
\item Codes starting with \code{2}: Days (converted to 0 years)
\item Codes starting with \code{3}: Months (converted to 0 years for <12 months)
\item Codes starting with \code{4}: Years (e.g., 4035 = 35 years)
\item Codes starting with \code{5}: 100+ years (e.g., 5105 = 105 years)
}
}

\strong{Age Groups}: Creates a factor variable \code{age_group} based on the specified
breaks and labels. Common epidemiological categories:
\itemize{
\item Pediatric: 0-4, 5-14, 15-19
\item Adult: 20-39, 40-59, 60+
\item Elderly: 65-74, 75-84, 85+
\item Climate-Health: 0-4, 5-64, 65+ (vulnerable populations)
}

\strong{Calendar Variables} (when \code{create_calendar_vars = TRUE}):
\itemize{
\item \code{day_of_week}: Day of the week (1 = Monday, 7 = Sunday)
\item \code{day_of_week_name}: Day name (e.g., "Monday", "Segunda-feira")
\item \code{month}: Month number (1-12)
\item \code{month_name}: Month name (e.g., "January", "Janeiro")
\item \code{year}: Year
\item \code{quarter}: Quarter (1-4)
\item \code{season}: Season (Summer, Autumn, Winter, Spring)
\item \code{is_weekend}: Logical indicating if date is weekend
\item \code{day_of_year}: Day of year (1-365/366)
\item \code{semester}: Semester (1 or 2)
}

\strong{Seasons} are calculated based on hemisphere:
\itemize{
\item \strong{Southern Hemisphere} (Brazil): Summer (Dec-Feb), Autumn (Mar-May),
Winter (Jun-Aug), Spring (Sep-Nov)
\item \strong{Northern Hemisphere}: Summer (Jun-Aug), Autumn (Sep-Nov),
Winter (Dec-Feb), Spring (Mar-May)
}
}
\examples{
\dontrun{
library(climasus4r)

# ===== EXAMPLE 1: SIM (Mortality) - Age already calculated =====
df_sim <- sus_data_import(uf = "SP", year = 2023, system = "SIM-DO") |>
  sus_data_standardize(lang = "en") |>
  sus_create_variables(
    create_age_groups = TRUE,
    age_breaks = c(0, 5, 65, Inf),
    age_labels = c("0-4", "5-64", "65+"),
    create_calendar_vars = TRUE,
    lang = "en"
  )
# Uses direct age column (fastest)

# ===== EXAMPLE 2: SINAN (Dengue) - Calculate from dates =====
df_sinan <- sus_data_import(uf = "RJ", year = 2023, system = "SINAN-DENGUE") |>
  sus_data_standardize(lang = "pt") |>
  sus_create_variables(
    create_age_groups = TRUE,
    age_breaks = c(0, 15, 60, Inf),
    create_calendar_vars = TRUE,
    lang = "pt"
  )
# Calculates age from DTNASC and DT_NOTIFIC (gold standard)

# ===== EXAMPLE 3: SIH (Hospitalizations) - Decode age codes =====
df_sih <- sus_data_import(uf = "MG", year = 2023, system = "SIH-RD") |>
  sus_data_standardize(lang = "es") |>
  sus_create_variables(
    create_age_groups = TRUE,
    age_breaks = c(0, 18, 60, Inf),
    age_labels = c("0-17", "18-59", "60+"),
    create_calendar_vars = TRUE,
    lang = "es"
  )
# Decodes DATASUS age codes if dates are missing (fallback)

# ===== EXAMPLE 4: Custom age groups for elderly analysis =====
df_elderly <- sus_create_variables(
  df,
  create_age_groups = TRUE,
  age_breaks = c(60, 70, 80, 90, Inf),
  age_labels = c("60-69", "70-79", "80-89", "90+"),
  lang = "pt"
)

# ===== EXAMPLE 5: Calendar variables and climate variables =====
df_calendar_climate <- sus_create_variables(
  df,
  create_calendar_vars = TRUE,
  create_semester = TRUE,
  create_climate_vars = TRUE,
  climate_region = "Norte"
)
}

}
