% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/sus_climate_inmet.R
\name{sus_climate_inmet}
\alias{sus_climate_inmet}
\title{Import, Harmonize, and Process INMET Meteorological Data with Epidemiological Intelligence}
\usage{
sus_climate_inmet(
  spatial_obj = NULL,
  years = NULL,
  uf = NULL,
  time_unit = "day",
  temporal_strategy = "exact",
  window_days = NULL,
  lag_days = NULL,
  impute_missing = FALSE,
  target_var = "tair_dry_bulb_c",
  quality_threshold = 0.4,
  use_cache = TRUE,
  cache_dir = "~/.climasus4r_cache/climate",
  parallel = TRUE,
  workers = 4,
  lang = "pt",
  verbose = TRUE
)
}
\arguments{
\item{spatial_obj}{An \code{sf} object (e.g., output from \code{sus_join_spatial()}) for
spatial matching. If NULL (default), returns processed meteorological data only.}

\item{years}{Numeric vector of year(s) to filter (e.g., \code{c(2020, 2023)} or \code{2020:2025}).
Must be between 2000 and the current year.}

\item{uf}{Character vector of Brazilian state codes (e.g., \code{c("SP","RJ")}).
If NULL, all states are included.}

\item{time_unit}{Character specifying temporal aggregation.
Options include:
\code{"hour"}, \code{"day"} (default), \code{"week"}, \code{"month"}, \code{"quarter"},
\code{"year"}, \code{"season"} (DJF, MAM, JJA, SON), or multi-period formats such as
\code{"2 days"}, \code{"5 days"}, \code{"14 days"}, \code{"3 months"}, \code{"6 months"}.}

\item{temporal_strategy}{Character. Strategy for temporal matching when
\code{spatial_obj} is provided. Must be one of:
\describe{
\item{"exact"}{Exact date matching between health and climate data.}
\item{"window"}{Aggregates climate variables within a symmetric window
around each health date (± \code{window_days}).}
\item{"lag"}{Creates lagged climate predictors based on \code{lag_days}.}
\item{"seasonal"}{Matches climate data by climatological season (DJF, MAM,
JJA, SON).}
}
Default: \code{"exact"}.}

\item{window_days}{Integer vector or single integer. Only used when
\code{temporal_strategy = "window"}. Defines the number of days before and after
each health date to aggregate climate variables (e.g., \code{7} = ±7 days).
If NULL and \code{temporal_strategy = "window"}, the function will error.}

\item{lag_days}{Integer vector. Only used when \code{temporal_strategy = "lag"}.
Defines temporal lags (in days) to create lagged climate variables
(e.g., \code{c(0, 7, 14)}). If NULL and \code{temporal_strategy = "lag"},
the function will error.}

\item{impute_missing}{Logical. If TRUE, fills missing values using
\code{sus_climate_fill_gaps()}, which trains station-specific XGBoost models with
temporal + meteorological predictors. Parallel processing is recommended. Imputation is performed on raw (high-frequency) data before aggregation.}

\item{target_var}{Character vector of variable (only one at once) to impute when
\code{impute_missing = TRUE}. Default: \code{"tair_dry_bulb_c"}. See variable list below.}

\item{quality_threshold}{Numeric. Maximum allowed proportion of missing values
per station/variable before skipping (default: 0.4). Stations are excluded if more than quality_threshold proportion of missing values exist for any target variable before imputation.}

\item{use_cache}{Logical. If TRUE, uses Arrow/Parquet cache to speed up repeated
processing of the same years/UFs.}

\item{cache_dir}{Character. Directory for cached files.
Default: \code{"~/.climasus4r_cache/climate"}.}

\item{parallel}{Logical. If TRUE, processes year/UF combinations in parallel.}

\item{workers}{Integer. Number of parallel workers (default = 4).}

\item{lang}{Character. Message language: \code{"pt"}, \code{"en"}, or \code{"es"}.}

\item{verbose}{Logical. If TRUE, prints progress messages.
\subsection{\strong{Accepted & Standardized Meteorological Variables}}{

The function \strong{accepts} the following INMET variables
(suggested canonical names in parentheses):
\itemize{
\item \code{rainfall_mm} (precipitation, mm)
\item \code{patm_mb} (mean atmospheric pressure, mb)
\item \code{patm_max_mb}, \code{patm_min_mb} (pressure extremes)
\item \code{sr_kj_m2} (solar radiation, kJ/m²)
\item \code{tair_dry_bulb_c} (mean air temperature, °C)
\item \code{tair_max_c}, \code{tair_min_c} (temperature extremes, °C)
\item \code{dew_tmean_c}, \code{dew_tmax_c}, \code{dew_tmin_c} (dew point, °C)
\item \code{rh_mean_porc}, \code{rh_max_porc}, \code{rh_min_porc} (relative humidity, \%)
\item \code{ws_2_m_s} (wind speed at 2m, m/s)
\item \code{ws_gust_m_s} (wind gust, m/s)
\item \code{wd_degrees} (wind direction, degrees)
}
}

\subsection{\strong{Missing Data Handling}}{

When \code{impute_missing = TRUE}, the function:
\enumerate{
\item Splits data by station
\item Trains two XGBoost models per station and variable:
\itemize{
\item Model A: Temporal + meteorological predictors
\item Model B: Temporal predictors only (fallback)
}
\item Uses Model A where meteorological covariates are available
\item Falls back to Model B when they are missing
\item Marks imputed values in an \code{is_imputed} column
}
}

\subsection{\strong{Spatial Matching} (if \code{spatial_obj} provided)}{

The function:
\enumerate{
\item Computes distances between municipality centroids and stations,
\item Assigns the nearest valid station,
\item Falls back to nearest station with a warning if no station meets quality criteria.
}
}

\subsection{\strong{Temporal Aggregation}}{

Aggregation supports:
\itemize{
\item Mean, sum, min, max depending on variable type,
\item Smart handling of radiation and wind,
\item Consistent alignment with epidemiological weeks when relevant.
}
}}
}
\value{
A tibble with processed meteorological data containing:
\itemize{
\item \code{date}: aggregated datetime,
\item \code{station_code}, \code{station_name}, \code{latitude}, \code{longitude},
\item Standardized climate variables (list above),
\item If \code{spatial_obj} provided: \code{code_mun}, \code{name_mun}, \code{distance_km}.
}
}
\description{
\code{sus_climate_inmet()} imports, standardizes, and processes Brazilian
meteorological data from INMET for environmental and epidemiological analysis.

The function implements:
\itemize{
\item \strong{Flexible temporal aggregation} (hour → season, including multi-period windows),
\item \strong{Optional spatial matching} to municipalities or other sf objects,
\item \strong{Optional gap-filling via machine learning (\code{sus_climate_fill_gaps()})}, and
\item \strong{Parallel, cache-aware processing} for large multi-year datasets.
}

This function is designed for:
\itemize{
\item Climate–health studies (e.g., dengue, malaria, heat stress),
\item Environmental exposure assessment,
\item Time-series gap filling and preprocessing,
\item Spatiotemporal integration of climate and health data.
}
}
\examples{
\dontrun{
# Basic processing
climate_processed <- sus_climate_inmet(
  years = 2020:2021,
  time_unit = "day"
)

# With spatial matching + gap filling
mun_sf <- sus_join_spatial(df_health)

climate_with_spatial <- sus_climate_inmet(
  spatial_obj = mun_sf,
  years = 2020:2021,
  uf = c("SP","RJ"),
  time_unit = "week",
  target_vars = c("tair_dry_bulb_c", "rh_mean_porc", "ws_2_m_s"),
  impute_missing = TRUE,
  parallel = TRUE,
  workers = 4
)
}

}
