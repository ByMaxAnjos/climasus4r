% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/sus_climate_inmet.R
\name{sus_climate_inmet}
\alias{sus_climate_inmet}
\title{Import and Process INMET Meteorological Data}
\usage{
sus_climate_inmet(
  years = NULL,
  uf = NULL,
  use_cache = TRUE,
  cache_dir = "~/.climasus4r_cache/climate",
  parallel = FALSE,
  workers = 4,
  lang = "pt",
  verbose = TRUE
)
}
\arguments{
\item{years}{Numeric vector of year(s) to import.
Examples: \code{2020}, \code{2020:2024}, \code{c(2019, 2021, 2023)}.
Must be between 2000 and current year. If \code{NULL}, imports last 2 years.}

\item{uf}{Character vector of Brazilian state codes (e.g., \code{"AM"},
\code{c("RJ", "MG")}). Case insensitive. If \code{NULL} (default), imports
\strong{all 27 states} (may be slow - see \strong{Performance}).}

\item{use_cache}{Logical. If \code{TRUE} (default), implements two-level caching:
\itemize{
\item \strong{Session cache}: In-memory cache (MD5 hash of parameters)
\item \strong{Disk cache}: Parquet files with Zstandard compression
}
Use \code{unlink(cache_dir, recursive = TRUE)} to clear all caches.}

\item{cache_dir}{Character. Directory path for disk cache.
Default: \code{"~/.climasus4r_cache/climate"}. Created automatically.}

\item{parallel}{Logical. If \code{TRUE} (default), enables \strong{two levels} of parallelism:
\itemize{
\item \strong{Between years}: Multiple years downloaded simultaneously
\item \strong{Within year}: CSV files for each year parsed in parallel
}
For single-year imports, only within-year parallelization applies.}

\item{workers}{Integer. Number of parallel workers. Default: \code{4}.
Ignored if \code{parallel = FALSE}. Uses \code{future::multisession} backend.
Automatically capped at \code{availableCores() - 1}.}

\item{lang}{Character. Message language. One of:
\itemize{
\item \code{"pt"}: Portuguese (default)
\item \code{"en"}: English
\item \code{"es"}: Spanish
}}

\item{verbose}{Logical. If \code{TRUE} (default), prints detailed progress including:
\itemize{
\item Cache hits/misses
\item Download progress with retry attempts
\item QC modifications (rows corrected/removed)
\item Final statistics
}}
}
\value{
A \code{climasus_df} object (subclass of \code{tibble}) with class hierarchy:
\code{climasus_df} > \code{tbl_df} > \code{tbl} > \code{data.frame}

\strong{Data Columns:}
\describe{
\item{\code{station_code}}{Character. INMET 8-digit station identifier (e.g., "A001")}
\item{\code{station_name}}{Character. Full station name}
\item{\code{region}}{Character. Brazilian region (Norte, Nordeste, etc.)}
\item{\code{UF}}{Character. State abbreviation}
\item{\code{latitude}, \code{longitude}, \code{altitude}}{Numeric. Station coordinates (WGS84)}
\item{\code{date}}{POSIXct. Observation timestamp \strong{UTC} (always hourly)}
\item{\code{year}}{Integer. Year extracted from date}
\item{\strong{Climate variables}}{Numeric. Standardized names (see \strong{Variables})}
}

\strong{Metadata} (accessible via \code{attr(x, "climasus_meta")}):
\describe{
\item{\code{version}}{Package version used}
\item{\code{timestamp}}{Import date/time}
\item{\code{source}}{"INMET"}
\item{\code{years}}{Years imported}
\item{\code{ufs}}{States imported}
\item{\code{cache_used}}{Whether cache was used}
\item{\code{qc_stats}}{List with quality control statistics}
\item{\code{n_stations}}{Number of unique stations}
\item{\code{n_observations}}{Total rows}
\item{\code{temporal_coverage}}{List with \code{start} and \code{end} dates}
\item{\code{history}}{Character vector of processing steps}
}
}
\description{
\code{sus_climate_inmet()} downloads, imports, standardizes, and quality-controls
Brazilian meteorological data from the National Institute of Meteorology (INMET).

The function implements a \strong{comprehensive processing pipeline}:
\enumerate{
\item \strong{Download}: Multi-year data with automatic retry and backoff
\item \strong{Parsing}: Handles INMET's CSV format with metadata extraction
\item \strong{Standardization}: Renames columns to canonical names (see \strong{Variables})
\item \strong{Quality Control}: Physical consistency checks (see \strong{QC Details})
\item \strong{Caching}: Two-level (memory + disk) with Parquet format
\item \strong{Parallel Processing}: Both between and within years
}
}
\note{
\itemize{
\item \strong{Data frequency}: Always \strong{hourly}. Use \code{sus_climate_aggregate()} for daily/weekly.
\item \strong{Timezone}: All timestamps are \strong{UTC}. Convert if needed.
\item \strong{Missing data}: Represented as \code{NA}. Use \code{sus_climate_fill_gaps()} for imputation.
\item \strong{Encoding}: All strings converted to UTF-8.
\item \strong{Decimals}: Converted from comma (\verb{,}) to point (\code{.}).
}
}
\section{Standardized Meteorological Variables}{


INMET raw column names vary by year. This function automatically detects and
renames them to the following canonical names:\tabular{llll}{
   \strong{Canonical Name} \tab \strong{Description} \tab \strong{Unit} \tab \strong{Physical Range} \cr
   \code{rainfall_mm} \tab Precipitation total \tab mm \tab 0 - 500 \cr
   \code{patm_mb} \tab Mean atmospheric pressure \tab mb \tab 700 - 1100 \cr
   \code{patm_max_mb} \tab Max atmospheric pressure \tab mb \tab 700 - 1100 \cr
   \code{patm_min_mb} \tab Min atmospheric pressure \tab mb \tab 700 - 1100 \cr
   \code{sr_kj_m2} \tab Solar radiation \tab kJ/m² \tab 0 - 40000 \cr
   \code{tair_dry_bulb_c} \tab Mean air temperature \tab °C \tab -90 - 60 \cr
   \code{tair_max_c} \tab Max air temperature \tab °C \tab -90 - 60 \cr
   \code{tair_min_c} \tab Min air temperature \tab °C \tab -90 - 60 \cr
   \code{dew_tmean_c} \tab Mean dew point \tab °C \tab -90 - 60 \cr
   \code{dew_tmax_c} \tab Max dew point \tab °C \tab -90 - 60 \cr
   \code{dew_tmin_c} \tab Min dew point \tab °C \tab -90 - 60 \cr
   \code{rh_mean_porc} \tab Mean relative humidity \tab \% \tab 0 - 100 \cr
   \code{rh_max_porc} \tab Max relative humidity \tab \% \tab 0 - 100 \cr
   \code{rh_min_porc} \tab Min relative humidity \tab \% \tab 0 - 100 \cr
   \code{ws_2_m_s} \tab Wind speed at 2m \tab m/s \tab 0 - 100 \cr
   \code{ws_gust_m_s} \tab Wind gust \tab m/s \tab 0 - 100 \cr
   \code{wd_degrees} \tab Wind direction \tab degrees \tab 0 - 360 \cr
}
}

\section{Quality Control Details}{


The function applies \strong{automatic physical consistency checks}:

\strong{1. Physical Range Validation:}
Values outside physically possible ranges are set to \code{NA}:
\itemize{
\item \strong{Temperature}: -90°C to 60°C
\item \strong{Pressure}: 700 mb to 1100 mb
\item \strong{Humidity}: 0\% to 100\%
\item \strong{Precipitation}: 0 mm to 500 mm
\item \strong{Solar radiation}: 0 to 40000 kJ/m²
\item \strong{Wind speed}: 0 to 100 m/s
\item \strong{Wind direction}: 0° to 360°
}

\strong{2. Dew Point Consistency:}
Calculates theoretical dew point from T and RH using Magnus formula.
If |observed - calculated| > 3°C, observed is set to NA.

\strong{3. Solar Radiation:}
Nighttime values (18h-6h) are set to 0 for physical consistency.
}

\section{Caching System Details}{


\strong{Disk Cache:}
\itemize{
\item \strong{Format}: Apache Parquet with Zstandard compression (level 6)
\item \strong{Partitioning}: By \code{year} and \code{UF} for fast filtering
\item \strong{Backup}: Compressed CSV as fallback if Parquet corrupted
\item \strong{Location}: \verb{~/.climasus4r_cache/climate/inmet_parquet/}
}
}

\examples{
\dontrun{
# Basic import - single state, single year
climate_am <- sus_climate_inmet(
  years = 2023,
  uf = "AM"
)


# Multi-year import with parallel processing
climate_sp <- sus_climate_inmet(
  years = 2020:2024,
  uf = "SP",
  parallel = TRUE,
  workers = 4
)

# Import all Southeast states
climate_se <- sus_climate_inmet(
  years = 2023,
  uf = c("SP", "RJ", "MG", "ES"),
  verbose = TRUE
)


# Inspect available stations
climate_df \%>\%
  dplyr::distinct(station_code, station_name, latitude, longitude)
}

}
\seealso{
\itemize{
\item \code{\link[=sus_climate_fill_gaps]{sus_climate_fill_gaps()}} for ML-based gap filling
\item \code{\link[=sus_join_spatial]{sus_join_spatial()}} for preparing municipality data
}
}
