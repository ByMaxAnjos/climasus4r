% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/sus_data_export.R
\name{sus_data_export}
\alias{sus_data_export}
\title{Export Processed Health Data with Metadata}
\usage{
sus_data_export(
  df,
  file_path,
  format = NULL,
  include_metadata = TRUE,
  metadata = NULL,
  compress = TRUE,
  compression_level = 6,
  overwrite = FALSE,
  lang = "pt",
  verbose = TRUE
)
}
\arguments{
\item{df}{A data frame or sf object containing the processed health data to export.}

\item{file_path}{Character string specifying the output file path. The file
extension determines the format if \code{format} is not explicitly specified.}

\item{format}{Character string specifying the output format. Options:
\code{"rds"} (default, R binary format), \code{"arrow"} (Apache Arrow/Parquet),
\code{"geoparquet"} (GeoArrow/GeoParquet for spatial data), \code{"shapefile"} (ESRI Shapefile), \code{"GeoPackage"},
and \code{"csv"} (comma-separated values).
If \code{NULL}, infers from \code{file_path} extension and data type (auto-detects sf objects).}

\item{include_metadata}{Logical. If \code{TRUE} (default), saves a companion
metadata file (\code{.txt} or \code{.json}) with processing information.}

\item{metadata}{Named list containing custom metadata to save. Common fields:
\itemize{
\item \code{source_system}: Health system (e.g., "SIM-DO")
\item \code{states}: Vector of state codes
\item \code{years}: Vector of years
\item \code{filters_applied}: Description of filters
\item \code{disease_groups}: Disease groups included
\item \code{processing_date}: Date of processing
\item \code{package_version}: climasus4r version
\item \code{author}: Analyst name
\item \code{notes}: Additional notes
}
If \code{NULL}, generates basic metadata automatically.}

\item{compress}{Logical. If \code{TRUE} (default for RDS and Arrow), compresses
the output file. Compression level can be specified for some formats.}

\item{compression_level}{Integer specifying compression level (1-9). Higher
values = smaller files but slower. Default is 6. Only applies to formats
that support compression.}

\item{overwrite}{Logical. If \code{TRUE}, overwrites existing files. If \code{FALSE}
(default), stops with an error if file exists.}

\item{lang}{Character string specifying the language for messages. Options:
\code{"en"} (English, default), \code{"pt"} (Portuguese), \code{"es"} (Spanish).}

\item{verbose}{Logical. If \code{TRUE} (default), prints export summary.}
}
\value{
Invisibly returns the file path of the exported data. If metadata
was saved, also returns the metadata file path as an attribute.
}
\description{
Exports processed health data to a file with optional metadata documentation
to ensure reproducibility. Supports multiple file formats optimized for
different use cases, including GeoArrow/GeoParquet for spatial data.
}
\details{
\strong{File Formats}:
\itemize{
\item \strong{RDS} (\code{.rds}): Native R format. Fast, compressed, preserves all
R object attributes. Best for R-only workflows.
\item \strong{Arrow/Parquet} (\code{.parquet}, \code{.arrow}): Columnar format. Excellent
compression, fast reading, language-agnostic. Best for large datasets
and interoperability with Python, Spark, etc.
\item \strong{GeoParquet} (\code{.geoparquet}, \code{.parquet} for sf objects): Optimized
columnar format for spatial data. Combines benefits of Parquet with
efficient geometry storage. 50-90\% smaller than shapefiles, 10-100x faster.
\item \strong{Shapefile} (\code{.shp} or \code{.gpkg}): Traditional GIS format. Widely supported but
inefficient for large datasets. Multiple files generated (.shp, .shx, .dbf, etc.).
\item \strong{CSV} (\code{.csv}): Universal text format. Human-readable, compatible
with all software. Best for sharing with non-R users. Larger file size.
Note: Geometries are exported as WKT (Well-Known Text) for spatial data.
}

\strong{Automatic Format Detection}:
If \code{format = NULL}, the function automatically detects the best format:
\itemize{
\item If input is an \code{sf} object and extension is \code{.parquet} → \code{"geoparquet"}
\item If input is an \code{sf} object and extension is \code{.shp} → \code{"shapefile"}
\item Otherwise, infers from file extension
}

\strong{Spatial Data Export}:
When exporting \code{sf} objects (spatial data from \code{sus_join_spatial()}):
\itemize{
\item \strong{Recommended}: Use GeoParquet format for optimal performance
\item GeoParquet preserves CRS, geometry types, and all attributes
\item Compatible with QGIS, Python (geopandas), and other GIS software
\item Significantly faster and smaller than shapefiles
}
}
\examples{
\dontrun{
library(climasus4r)

# Export regular data frame to RDS
sus_data_export(df_final, "output/data.rds")

# Export spatial data to GeoParquet (RECOMMENDED)
sf_result <- sus_join_spatial(df, level = "munic")
sus_data_export(
  sf_result,
  file_path = "output/spatial_data.geoparquet",
  format = "geoparquet"  # Auto-detected if extension is .parquet
)

# Export spatial data to Shapefile (traditional)
sus_data_export(
  sf_result,
  file_path = "output/spatial_data.shp",
  format = "shapefile"
)

# Export to Arrow with custom metadata
sus_data_export(
  df_final,
  file_path = "output/respiratory_sp_2023.parquet",
  format = "arrow",
  metadata = list(
    source_system = "SIM-DO",
    states = "SP",
    years = 2023,
    disease_groups = "respiratory",
    author = "Max Anjos"
  )
)
}

}
