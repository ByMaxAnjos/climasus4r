% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/sus_data_aggregate.R
\name{sus_data_aggregate}
\alias{sus_data_aggregate}
\title{Aggregate Health Data into Time Series}
\usage{
sus_data_aggregate(
  df,
  time_unit = "day",
  fun = "count",
  value_col = NULL,
  date_col = NULL,
  group_by = NULL,
  complete_dates = TRUE,
  lang = "pt",
  verbose = TRUE
)
}
\arguments{
\item{df}{A data frame containing health data (output from \code{sus_data_standardize()}).}

\item{time_unit}{Character string specifying the temporal aggregation unit.
\strong{Standard units}: \code{"day"}, \code{"week"}, \code{"month"}, \code{"quarter"}, \code{"year"}
\strong{Multi-day/week/month}: \code{"2 days"}, \code{"5 days"} (pentads), \code{"14 days"} (fortnightly),
\code{"3 months"} (trimester), \code{"6 months"} (semester).
\strong{Special}: \code{"season"} (Brazilian seasons: DJF, MAM, JJA, SON).
Default is \code{"day"}.}

\item{fun}{Character string or list of functions specifying the aggregation function(s).
Options: \code{"count"} (default), \code{"sum"}, \code{"mean"}, \code{"median"}, \code{"min"}, \code{"max"},
\code{"sd"}, \code{"q25"} (25th percentile), \code{"q75"}, \code{"q95"}, and \code{"q99"}.
Can also be a named list for multiple aggregations, e.g.,
\code{list(mean_temp = "mean", max_temp = "max")}.}

\item{value_col}{Character string with the name of the column to aggregate when
using functions other than \code{"count"}. Required for \code{"sum"}, \code{"mean"}, etc.
For example, \code{"temperature"}, \code{"precipitation"}, \code{"pm25"}.}

\item{date_col}{Character string with the name of the date column to use for
aggregation. If \code{NULL} (default), the function will attempt to auto-detect
the date column based on common patterns.}

\item{group_by}{Character vector with names of columns to group by (e.g.,
\code{c("sex", "age_group", "municipality_code", "race")}). If \code{NULL} (default), aggregates
across all records.}

\item{complete_dates}{Logical. If \code{TRUE} (default), fills in missing time periods
with zero counts to create a complete time series without gaps.}

\item{lang}{Character string specifying the language for messages. Options:
\code{"en"} (English, default), \code{"pt"} (Portuguese, default), \code{"es"} (Spanish).}

\item{verbose}{Logical. If \code{TRUE} (default), prints progress messages.}
}
\value{
A tibble with aggregated data containing:
\itemize{
\item \code{date}: The aggregated date (start of period)
\item Grouping columns (if \code{group_by} was specified)
\item Aggregated value column(s) with smart names based on system and function
}
}
\description{
Aggregates individual-level health data into time series counts by specified
time units and grouping variables. This function is essential for preparing
data for time series analysis, DLNM models, and other temporal epidemiological methods.
}
\details{
\strong{New Features}:
\itemize{
\item \strong{Multiple aggregation functions}: Beyond counting, you can now calculate
mean, sum, median, percentiles, etc., useful for climate and environmental data.
\item \strong{Smart column naming}: The aggregated column is automatically named
based on the health system (e.g., \code{n_deaths} for SIM-DO, \code{n_hospitalizations}
for SIH-RD, \code{n_births} for SINASC).
}
\strong{Epidemiological Use Cases}:
\itemize{
\item \strong{Daily/Weekly}: Standard time series analysis, DLNM for short-term effects
\item \strong{Pentads (5 days)}: Heat wave analysis, smoothing daily noise
\item \strong{Fortnightly (14 days)}: Diseases with longer incubation periods
\item \strong{Monthly}: Seasonal patterns, long-term trends
\item \strong{Quarterly}: SUS management reports, policy evaluation
\item \strong{Seasonal}: Dengue, Influenza, respiratory diseases aligned with Brazilian climate
\item \strong{Yearly}: Long-term trend analysis, climate change impacts
}

\strong{Brazilian Seasons} (when \code{time_unit = "season"}):
\itemize{
\item \strong{Summer (Verao)}: December-January-February (DJF)
\item \strong{Autumn (Outono)}: March-April-May (MAM)
\item \strong{Winter (Inverno)}: June-July-August (JJA)
\item \strong{Spring (Primavera)}: September-October-November (SON)
}
}
\examples{
\dontrun{
library(climasus4r)

# Basic daily aggregation
df_daily <- sus_data_import(uf = "SP", year = 2023, system = "SIM-DO") |>
  sus_data_standardize() |>
  sus_data_filter_cid(disease_group = "respiratory") |>
  sus_data_aggregate(time_unit = "day")

# Pentad aggregation (5-day periods) for heat wave analysis
df_pentad <- sus_data_aggregate(df, time_unit = "5 days")

# Fortnightly aggregation for diseases with longer incubation
df_fortnightly <- sus_data_aggregate(df, time_unit = "14 days")

# Monthly aggregation by municipality
df_monthly <- sus_data_aggregate(
  df,
  time_unit = "month",
  group_by = c("race", "sex"),
  lang = "pt"
)

# Quarterly aggregation for SUS reports
df_quarterly <- sus_data_aggregate(df, time_unit = "quarter")

# Seasonal aggregation for dengue analysis (Brazilian seasons)
df_seasonal <- sus_data_aggregate(
  df,
  time_unit = "season",
  group_by = "state"
)

# Weekly aggregation by age group and sex
df_weekly <- sus_data_aggregate(
  df,
  time_unit = "week",
  group_by = c("age_group", "sex")
)
}
}
