% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/sus_join_spatial.R
\name{sus_join_spatial}
\alias{sus_join_spatial}
\title{Spatially Link SUS Data to Brazilian Geographic Units}
\usage{
sus_join_spatial(
  df,
  level = "munic",
  join_col = NULL,
  lang = "pt",
  use_cache = TRUE,
  cache_dir = "~/.climasus4r_cache/spatial",
  verbose = TRUE
)
}
\arguments{
\item{df}{A \code{data.frame} containing health data with a geographic identifier column.
The data frame should have a \code{system} column created by \code{detect_health_system()}.}

\item{level}{Character string specifying the geographic aggregation level. Default is \code{"munic"}.
Options:
\itemize{
\item \strong{Administrative:} "munic" (municipality). Default.
\item \strong{Health:} "health_region", "health_facilities", "schools"
\item \strong{Environmental:} "amazon", "biomes", "conservation_units",
"disaster_risk_area", "semiarid", "indigenous_land"
\item \strong{Urban:} "neighborhood", "urban_area", "metro_area",
"urban_concentrations", "pop_arrangements",
\item \strong{Miscellaneous:} "cep" (postal code)
}
\strong{Note}: \code{"cep"} level is only available for SIH and CNES systems.}

\item{join_col}{Character string with the name of the column in \code{df} containing
the geographic identifier. If \code{NULL} (default), the function will automatically
detect the appropriate column based on the \code{level} and common SUS column patterns.}

\item{lang}{Character string specifying the language for messages.
Options: \code{"pt"} (Portuguese, default), \code{"en"} (English), \code{"es"} (Spanish).}

\item{use_cache}{Logical. If \code{TRUE} (default), uses cached spatial data to avoid
re-downloads and improve performance.}

\item{cache_dir}{Character string specifying the directory to store cached files.
Default is \code{"~/.climasus4r_cache/spatial"}.}

\item{verbose}{Logical. If \code{TRUE} (default), prints detailed progress information
including cache status, download progress, and join statistics.}
}
\value{
An \code{sf} object (Simple Features data.frame) with all original columns from
\code{df} plus a \code{geometry} column containing the spatial geometries:
\itemize{
\item \strong{/munic/neighborhood}: POLYGON or MULTIPOLYGON geometries
\item \strong{/cnes/cep}: POINT geometries (geocoded locations)
}
}
\description{
Performs a spatial join between a data.frame containing SUS data
and official Brazilian geographic boundaries (state, municipality, census tract)
or geocodes postal codes (CEP). This function is the core spatial engine for the
entire climasus4r package and serves as the foundation for all spatial analyses.
}
\details{
\strong{Caching Strategy}:
Spatial data is cached as Parquet files in \verb{~/.climasus4r_cache/spatial} to:
\itemize{
\item Avoid repeated downloads
\item Improve performance (10-100x faster)
\item Enable offline reuse
}

\strong{Code Normalization}:
\itemize{
\item \strong{Municipality codes}: Accepts 6 or 7 digits; 7-digit codes have the
verification digit removed automatically
\item \strong{CEP}: Always zero-padded to 8 characters
\item All join columns are coerced to character type
}
}
\examples{
\dontrun{
library(climasus4r)

# Example 1: Link mortality data to municipalities
df_sim <- sus_data_import(uf = "SP", year = 2023, system = "SIM-DO") \%>\%
  sus_data_standardize(lang = "pt")

sf_sim <- sus_join_spatial(
  df = df_sim,
  level = "munic",
  lang = "pt"
)

# Example 3: Geocode CEP for hospitalization data (SIH only)
df_sih <- sus_data_import(uf = "RJ", year = 2023, system = "SIH-RD") \%>\%
  sus_data_standardize(lang = "pt")

sf_cep <- sus_join_spatial(
  df = df_sih,
  level = "cep",
  lang = "pt"
)

# Example 4: Census tract level analysis
sf_census <- sus_join_spatial(
  df = df_sim,
  level = "school",
  lang = "pt"
)
}
}
\references{
Pereira, R.H.M.; Goncalves, C.N.; et. all (2019) geobr: Loads Shapefiles of Official Spatial Data Sets of Brazil. GitHub repository - https://github.com/ipeaGIT/geobr.
Pereira, Rafael H. M.; Barbosa, Rogerio J. (2023) censobr: Download Data from Brazilâ€™s Population Census. R package version v0.4.0, https://CRAN.R-project.org/package=censobr. DOI: 10.32614/CRAN.package.censobr.
}
