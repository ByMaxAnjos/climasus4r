% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/sus_climate_fill_gap.R
\name{sus_climate_fill_gaps}
\alias{sus_climate_fill_gaps}
\title{Gap-filling of climate data with station-wise machine learning}
\usage{
sus_climate_fill_gaps(
  df,
  target_var,
  datetime_col = NULL,
  station_col = NULL,
  source = "auto",
  quality_threshold = 0.4,
  lag_periods = c(3, 6, 12, 24),
  rolling_windows = c(3, 6, 12),
  run_evaluation = FALSE,
  gap_percentage = 0.2,
  gap_mechanism = "MCAR",
  keep_features = FALSE,
  model_params = list(),
  n_workers = NULL,
  verbose = TRUE,
  lang = "pt"
)
}
\arguments{
\item{df}{A data.frame (or tibble) containing climate or air-quality data.
Must include:
\itemize{
\item a datetime column (POSIXct, POSIXlt, or convertible to datetime),
\item a station identifier column,
\item at least one numeric target variable to be filled.
}}

\item{target_var}{Character vector. One or more variable names to be gap-filled.
Each variable is modeled and imputed \strong{independently}.
Example: \code{c("tair_dry_bulb_c", "rh_mean_porc", "ws_2_m_s")}.}

\item{datetime_col}{Character. Name of the datetime column in \code{df}.
If \code{NULL} (default), the function attempts automatic detection.}

\item{station_col}{Character. Name of the station identifier column.
If \code{NULL}, it is auto-detected based on the declared \code{source}.}

\item{source}{Character. Data source identifier:
\itemize{
\item \code{"INMET"} (Brazilian weather stations),
\item \code{"NOAA"} (global weather stations),
\item \code{"AirQuality"} (air pollution data),
\item \code{"auto"} (default): automatically detected from column patterns.
}}

\item{quality_threshold}{Numeric. Maximum allowed proportion of missing values \strong{per station
and per variable}.
Stations exceeding this threshold are excluded for that variable.
Default: \code{0.4} (40\% missing).}

\item{lag_periods}{Numeric vector. Time lags (in hours) used to construct predictors.
Default: \code{c(3, 6, 12, 24)}.}

\item{rolling_windows}{Numeric vector. Window sizes (in hours) for rolling statistics
(mean and standard deviation).
Default: \code{c(3, 6, 12)}.}

\item{run_evaluation}{Logical. If \code{TRUE}, performs an internal missing-data simulation to assess
imputation performance (RMSE / MAE). Default: \code{FALSE}.}

\item{gap_percentage}{Numeric. If \code{run_evaluation = TRUE}, proportion of observed data
artificially removed to test performance. Default: \code{0.2} (20\%).}

\item{gap_mechanism}{Character. Missing-data mechanism used in evaluation when
\code{run_evaluation = TRUE}:
\itemize{
\item \code{"MCAR"}: Missing Completely At Random (default),
\item \code{"MAR"}: Missing At Random,
\item \code{"MNAR"}: Missing Not At Random.
}}

\item{keep_features}{Logical. If \code{TRUE}, retains engineered features (lags, rolling statistics,
and temporal variables).
If \code{FALSE} (default), only original columns + \verb{is_imputed_*} are returned.}

\item{model_params}{List of additional XGBoost parameters to override defaults.
Example:
\code{
  list(max_depth = 4, eta = 0.05, nrounds = 200)
  }}

\item{n_workers}{Integer. Number of parallel workers.
If \code{NULL} (default), uses \code{availableCores() - 1}.}

\item{verbose}{Logical. If \code{TRUE}, prints progress messages and warnings.}

\item{lang}{Character. Language for messages:
\code{"pt"}, \code{"en"}, or \code{"es"}. Default: \code{"pt"}.}
}
\value{
An object of class \code{"climasus_df"} with updated metadata, containing:
\itemize{
\item \strong{data}: original data with filled values,
\item \strong{is_imputed_\if{html}{\out{<var>}}}: logical flag per variable indicating which values were imputed,
\item \strong{climasus_meta}: metadata including:
\itemize{
\item data source,
\item number of imputed values,
\item imputation rate,
\item processing time,
\item quality threshold used.
}
}
}
\description{
This function performs data-driven gap-filling (statistical imputation) in
climate and air-quality time series using gradient boosting (XGBoost).

The method:
\itemize{
\item Trains \strong{one separate model per station} and per target variable;
\item Uses automatic temporal feature engineering (lags and rolling windows);
\item Applies station-level quality filtering before modeling;
\item Supports multiple data sources (e.g., INMET, NOAA, AirQuality);
\item Can run in parallel across stations;
\item Returns both filled data and processing metadata.
}

\strong{Important methodological notes:}
\itemize{
\item This is a \strong{gap-filling (imputation) method, NOT a forecasting model}.
Predictions are only made for timestamps where data are missing.
\item Models are trained \strong{only on observed (non-missing) data} within each station.
\item No information from the future is used to impute past values
(only lagged and rolling features are used).
\item If a station exceeds the allowed missingness threshold for a variable,
that variable is not imputed for that station.
}
}
\details{
Fill gaps in climate and air-quality time series using XGBoost
}
\examples{
\dontrun{
# Basic usage (single variable)
filled_data <- sus_climate_fill_gaps(
  df = inmet_climate,
  target_var = "tair_dry_bulb_c"
)

# Multiple variables in one call
filled_data <- sus_climate_fill_gaps(
  df = climate_data,
  target_var = c("tair_dry_bulb_c", "rh_mean_porc", "ws_2_m_s"),
  quality_threshold = 0.4
)

# With performance evaluation
filled_data <- sus_climate_fill_gaps(
  df = climate_data,
  target_var = "tair_dry_bulb_c",
  run_evaluation = TRUE,
  gap_percentage = 0.2
)
}

}
