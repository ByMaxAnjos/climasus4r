<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Spatially Link SUS Data to Brazilian Geographic Units — sus_join_spatial • climasus4r</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Inter-0.4.10/font.css" rel="stylesheet"><link href="../deps/Fira_Code-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Spatially Link SUS Data to Brazilian Geographic Units — sus_join_spatial"><meta name="description" content="Performs a spatial join between a data.frame containing SUS data
and official Brazilian geographic boundaries (state, municipality, census tract)
or geocodes postal codes (CEP). This function is the core spatial engine for the
entire climasus4r package and serves as the foundation for all spatial analyses."><meta property="og:description" content="Performs a spatial join between a data.frame containing SUS data
and official Brazilian geographic boundaries (state, municipality, census tract)
or geocodes postal codes (CEP). This function is the core spatial engine for the
entire climasus4r package and serves as the foundation for all spatial analyses."><link rel="stylesheet" href="pkgdown/assets/custom-modern.css"><link rel="icon" type="image/png" href="pkgdown/assets/favicon.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">climasus4r</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html">Home</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/about.html">About</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/tutorials.html">Tutorials</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/case-studies.html">Case Studies</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-community" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Community</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-community"><li><a class="external-link dropdown-item" href="https://github.com/ByMaxAnjos/climasus4r/issues">GitHub Issues</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/ByMaxAnjos/climasus4r/discussions">Discussions</a></li>
  </ul></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://climasus4r.manus.space/" target="_blank"><span class="fa fa-robot"></span> AI Assistant</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ByMaxAnjos/climasus4r"><span class="fa fa-github"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../../pt/index.html">Português</a></li>
<li class="nav-item"><a class="nav-link" href="../../es/index.html">Español</a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Spatially Link SUS Data to Brazilian Geographic Units</h1>
      <small class="dont-index">Source: <a href="https://github.com/ByMaxAnjos/climasus4r/blob/master/R/sus_join_spatial.R" class="external-link"><code>R/sus_join_spatial.R</code></a></small>
      <div class="d-none name"><code>sus_join_spatial.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Performs a spatial join between a data.frame containing SUS data
and official Brazilian geographic boundaries (state, municipality, census tract)
or geocodes postal codes (CEP). This function is the core spatial engine for the
entire climasus4r package and serves as the foundation for all spatial analyses.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">sus_join_spatial</span><span class="op">(</span></span>
<span>  <span class="va">df</span>,</span>
<span>  level <span class="op">=</span> <span class="st">"munic"</span>,</span>
<span>  join_col <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  lang <span class="op">=</span> <span class="st">"pt"</span>,</span>
<span>  use_cache <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  cache_dir <span class="op">=</span> <span class="st">"~/.climasus4r_cache/spatial"</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-df">df<a class="anchor" aria-label="anchor" href="#arg-df"></a></dt>
<dd><p>A <code>data.frame</code> containing health data with a geographic identifier column.
The data frame should have a <code>system</code> column created by <code>detect_health_system()</code>.</p></dd>


<dt id="arg-level">level<a class="anchor" aria-label="anchor" href="#arg-level"></a></dt>
<dd><p>Character string specifying the geographic aggregation level. Default is <code>"munic"</code>.
Options:</p><ul><li><p><strong>Administrative:</strong> "munic" (municipality). Default.</p></li>
<li><p><strong>Health:</strong> "health_region", "health_facilities", "schools"</p></li>
<li><p><strong>Environmental:</strong> "amazon", "biomes", "conservation_units",
"disaster_risk_area", "semiarid", "indigenous_land"</p></li>
<li><p><strong>Urban:</strong> "neighborhood", "urban_area", "metro_area",
"urban_concentrations", "pop_arrangements",</p></li>
<li><p><strong>Miscellaneous:</strong> "cep" (postal code)</p></li>
</ul><p><strong>Note</strong>: <code>"cep"</code> level is only available for SIH and CNES systems.</p></dd>


<dt id="arg-join-col">join_col<a class="anchor" aria-label="anchor" href="#arg-join-col"></a></dt>
<dd><p>Character string with the name of the column in <code>df</code> containing
the geographic identifier. If <code>NULL</code> (default), the function will automatically
detect the appropriate column based on the <code>level</code> and common SUS column patterns.</p></dd>


<dt id="arg-lang">lang<a class="anchor" aria-label="anchor" href="#arg-lang"></a></dt>
<dd><p>Character string specifying the language for messages.
Options: <code>"pt"</code> (Portuguese, default), <code>"en"</code> (English), <code>"es"</code> (Spanish).</p></dd>


<dt id="arg-use-cache">use_cache<a class="anchor" aria-label="anchor" href="#arg-use-cache"></a></dt>
<dd><p>Logical. If <code>TRUE</code> (default), uses cached spatial data to avoid
re-downloads and improve performance.</p></dd>


<dt id="arg-cache-dir">cache_dir<a class="anchor" aria-label="anchor" href="#arg-cache-dir"></a></dt>
<dd><p>Character string specifying the directory to store cached files.
Default is <code>"~/.climasus4r_cache/spatial"</code>.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Logical. If <code>TRUE</code> (default), prints detailed progress information
including cache status, download progress, and join statistics.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An <code>sf</code> object (Simple Features data.frame) with all original columns from
<code>df</code> plus a <code>geometry</code> column containing the spatial geometries:</p><ul><li><p><strong>/munic/neighborhood</strong>: POLYGON or MULTIPOLYGON geometries</p></li>
<li><p><strong>/cnes/cep</strong>: POINT geometries (geocoded locations)</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><strong>Caching Strategy</strong>:
Spatial data is cached as Parquet files in <code>~/.climasus4r_cache/spatial</code> to:</p><ul><li><p>Avoid repeated downloads</p></li>
<li><p>Improve performance (10-100x faster)</p></li>
<li><p>Enable offline reuse</p></li>
</ul><p><strong>Code Normalization</strong>:</p><ul><li><p><strong>Municipality codes</strong>: Accepts 6 or 7 digits; 7-digit codes have the
verification digit removed automatically</p></li>
<li><p><strong>CEP</strong>: Always zero-padded to 8 characters</p></li>
<li><p>All join columns are coerced to character type</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Pereira, R.H.M.; Goncalves, C.N.; et. all (2019) geobr: Loads Shapefiles of Official Spatial Data Sets of Brazil. GitHub repository - https://github.com/ipeaGIT/geobr.
Pereira, Rafael H. M.; Barbosa, Rogerio J. (2023) censobr: Download Data from Brazil’s Population Census. R package version v0.4.0, https://CRAN.R-project.org/package=censobr. DOI: 10.32614/CRAN.package.censobr.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">climasus4r</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Example 1: Link mortality data to municipalities</span></span>
<span><span class="va">df_sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="sus_data_import.html">sus_data_import</a></span><span class="op">(</span>uf <span class="op">=</span> <span class="st">"SP"</span>, year <span class="op">=</span> <span class="fl">2023</span>, system <span class="op">=</span> <span class="st">"SIM-DO"</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="sus_data_standardize.html">sus_data_standardize</a></span><span class="op">(</span>lang <span class="op">=</span> <span class="st">"pt"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sf_sim</span> <span class="op">&lt;-</span> <span class="fu">sus_join_spatial</span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">df_sim</span>,</span>
<span>  level <span class="op">=</span> <span class="st">"munic"</span>,</span>
<span>  lang <span class="op">=</span> <span class="st">"pt"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Example 3: Geocode CEP for hospitalization data (SIH only)</span></span>
<span><span class="va">df_sih</span> <span class="op">&lt;-</span> <span class="fu"><a href="sus_data_import.html">sus_data_import</a></span><span class="op">(</span>uf <span class="op">=</span> <span class="st">"RJ"</span>, year <span class="op">=</span> <span class="fl">2023</span>, system <span class="op">=</span> <span class="st">"SIH-RD"</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="sus_data_standardize.html">sus_data_standardize</a></span><span class="op">(</span>lang <span class="op">=</span> <span class="st">"pt"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sf_cep</span> <span class="op">&lt;-</span> <span class="fu">sus_join_spatial</span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">df_sih</span>,</span>
<span>  level <span class="op">=</span> <span class="st">"cep"</span>,</span>
<span>  lang <span class="op">=</span> <span class="st">"pt"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Example 4: Census tract level analysis</span></span>
<span><span class="va">sf_census</span> <span class="op">&lt;-</span> <span class="fu">sus_join_spatial</span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">df_sim</span>,</span>
<span>  level <span class="op">=</span> <span class="st">"school"</span>,</span>
<span>  lang <span class="op">=</span> <span class="st">"pt"</span></span>
<span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="co"># }</span></span></code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Max Anjos, Thaua Menezes.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

