<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Add Census Socioeconomic variables to Health Data — sus_socio_add_census • climasus4r</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Inter-0.4.10/font.css" rel="stylesheet"><link href="../deps/Fira_Code-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Add Census Socioeconomic variables to Health Data — sus_socio_add_census"><meta name="description" content="Enriches health data with socioeconomic indicators from Brazilian Census using
the censobr package. Provides aggregation of microdata to municipality level. Supports multiple census datasets (population, households,
families, mortality, emigration) with intelligent caching and optimized performance for large datasets using Arrow/Parquet format."><meta property="og:description" content="Enriches health data with socioeconomic indicators from Brazilian Census using
the censobr package. Provides aggregation of microdata to municipality level. Supports multiple census datasets (population, households,
families, mortality, emigration) with intelligent caching and optimized performance for large datasets using Arrow/Parquet format."><link rel="stylesheet" href="pkgdown/assets/custom-modern.css"><link rel="icon" type="image/png" href="pkgdown/assets/favicon.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">climasus4r</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html">Home</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/about.html">About</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/tutorials.html">Tutorials</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/case-studies.html">Case Studies</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-community" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Community</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-community"><li><a class="external-link dropdown-item" href="https://github.com/ByMaxAnjos/climasus4r/issues">GitHub Issues</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/ByMaxAnjos/climasus4r/discussions">Discussions</a></li>
  </ul></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://climasus4r.manus.space/" target="_blank"><span class="fa fa-robot"></span> AI Assistant</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ByMaxAnjos/climasus4r"><span class="fa fa-github"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../../pt/index.html">Português</a></li>
<li class="nav-item"><a class="nav-link" href="../../es/index.html">Español</a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Add Census Socioeconomic variables to Health Data</h1>
      <small class="dont-index">Source: <a href="https://github.com/ByMaxAnjos/climasus4r/blob/master/R/sus_socio_add_census.R" class="external-link"><code>R/sus_socio_add_census.R</code></a></small>
      <div class="d-none name"><code>sus_socio_add_census.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Enriches health data with socioeconomic indicators from Brazilian Census using
the <code>censobr</code> package. Provides aggregation of microdata to municipality level. Supports multiple census datasets (population, households,
families, mortality, emigration) with intelligent caching and optimized performance for large datasets using Arrow/Parquet format.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">sus_socio_add_census</span><span class="op">(</span></span>
<span>  <span class="va">df</span>,</span>
<span>  dataset <span class="op">=</span> <span class="st">"population"</span>,</span>
<span>  year <span class="op">=</span> <span class="fl">2010</span>,</span>
<span>  vars <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  aggregation_fun <span class="op">=</span> <span class="st">"sum"</span>,</span>
<span>  join_muni_col <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  use_cache <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  cache_dir <span class="op">=</span> <span class="st">"~/.climasus4r_cache/census"</span>,</span>
<span>  lang <span class="op">=</span> <span class="st">"pt"</span>,</span>
<span>  translate_columns <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  standardize_values <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-df">df<a class="anchor" aria-label="anchor" href="#arg-df"></a></dt>
<dd><p>A <code>data.frame</code> or <code>sf</code> object containing health data. Typically the output from <code><a href="sus_join_spatial.html">sus_join_spatial()</a></code> function.</p></dd>


<dt id="arg-dataset">dataset<a class="anchor" aria-label="anchor" href="#arg-dataset"></a></dt>
<dd><p>Character string specifying the census dataset to use. Options:</p><ul><li><p><code>"population"</code> - Population microdata (default)</p></li>
<li><p><code>"households"</code> - Household microdata</p></li>
<li><p><code>"families"</code> - Family microdata</p></li>
<li><p><code>"mortality"</code> - Mortality microdata</p></li>
<li><p><code>"emigration"</code> - Emigration microdata</p></li>
<li><p><code>"tracts"</code> - Census tract aggregate data (coming soon...)</p></li>
</ul></dd>


<dt id="arg-year">year<a class="anchor" aria-label="anchor" href="#arg-year"></a></dt>
<dd><p>Integer specifying census year. Options: <code>2010</code> (default) or <code>2000</code>.
Note: Dataset availability varies by year.</p></dd>


<dt id="arg-vars">vars<a class="anchor" aria-label="anchor" href="#arg-vars"></a></dt>
<dd><p>Character vector specifying census variables to add. Use <code><a href="sus_census_explore.html">sus_census_explore()</a></code> to select available variables.
If <code>NULL</code>, returns all available variables (not recommended for large datasets).</p></dd>


<dt id="arg-aggregation-fun">aggregation_fun<a class="anchor" aria-label="anchor" href="#arg-aggregation-fun"></a></dt>
<dd><p>Character. Method to aggregate microdata to municipality level:</p><ul><li><p><code>"sum"</code> - Sums the selected variables by municipality (e.g., for total population).</p></li>
<li><p><code>"mean"</code> - Averages the selected variables (e.g., for income).</p></li>
<li><p><code>"median"</code>, <code>"min"</code>, <code>"max"</code>, <code>"sd"</code>, <code>"q25"</code>, <code>"q75"</code>, <code>"q95"</code>, and <code>"q99"</code>.</p></li>
</ul></dd>


<dt id="arg-join-muni-col">join_muni_col<a class="anchor" aria-label="anchor" href="#arg-join-muni-col"></a></dt>
<dd><p>Character string specifying the column in df containing the <strong>6 or 7-digit IBGE municipality code</strong>. If <code>NULL</code>, detects common SUS patterns (e.g., <code>code_muni</code>).</p></dd>


<dt id="arg-use-cache">use_cache<a class="anchor" aria-label="anchor" href="#arg-use-cache"></a></dt>
<dd><p>Logical. If <code>TRUE</code> (default), uses censobr's caching system to store
downloaded data locally for faster subsequent access.</p></dd>


<dt id="arg-cache-dir">cache_dir<a class="anchor" aria-label="anchor" href="#arg-cache-dir"></a></dt>
<dd><p>Character string specifying cache directory path. Defaults to
<code>"~/.climasus4r_cache/census"</code>.The function automatically calls <code>censobr::set_censobr_cache_dir(cache_dir)</code> to ensure consistency across the ecosystem.</p></dd>


<dt id="arg-lang">lang<a class="anchor" aria-label="anchor" href="#arg-lang"></a></dt>
<dd><p>Character string specifying language for messages. Options: <code>"pt"</code> (Portuguese, default), <code>"en"</code> (English), <code>"es"</code> (Spanish).</p></dd>


<dt id="arg-translate-columns">translate_columns<a class="anchor" aria-label="anchor" href="#arg-translate-columns"></a></dt>
<dd><p>Logical. If TRUE, translates column names. Default is TRUE.</p></dd>


<dt id="arg-standardize-values">standardize_values<a class="anchor" aria-label="anchor" href="#arg-standardize-values"></a></dt>
<dd><p>Logical. If TRUE, standardizes categorical values. Default is TRUE.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Logical. If <code>TRUE</code> (default), prints progress messages and download progress bar.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Returns the input <code>data.frame</code> or <code>sf</code> object with additional columns. If the input is an sf object, the spatial geometry and CRS are strictly preserved through a join.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><strong>Integration with censobr package</strong>:
This function is a wrapper around censobr's dataset-specific functions
(<code>read_population()</code>, <code>read_households()</code>, etc.), providing seamless integration
with the climasus4r ecosystem.</p>
<p><strong>Geographic Columns</strong>:
The function automatically inherits and matches geographic columns following
the geobr/censobr standard:</p><ul><li><p><code>code_muni</code> - 7-digit municipality code</p></li>
<li><p><code>code_state</code> - 2-digit state code</p></li>
<li><p><code>abbrev_state</code> - State abbreviation (e.g., "AM")</p></li>
<li><p><code>name_state</code> - State name</p></li>
<li><p><code>code_region</code> - Region code</p></li>
<li><p><code>name_region</code> - Region name</p></li>
<li><p><code>code_weighting</code> - Weighting area code</p></li>
</ul><p><strong>Automatic Column Detection</strong>:
If <code>join_muni_col = NULL</code>, the function automatically detects the appropriate code municipality
column based on common SUS patterns:</p><ul><li><p><strong>Municipality</strong>: <code>residence_municipality_code</code>, <code>municipality_code</code>,
<code>codigo_municipio</code>, <code>CODMUNRES</code>, etc.</p></li>
</ul><p><strong>Performance Optimization</strong>:
The function uses Arrow/Parquet format for efficient larger-than-memory dataset handling:</p><ul><li><p>Downloads data only once (cached locally)</p></li>
<li><p>Filters municipalities BEFORE loading to RAM</p></li>
<li><p>Uses <code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">dplyr::collect()</a></code> only after filtering</p></li>
<li><p>Uses <code>sfarrow</code> pak for spatial filtering</p></li>
</ul><p><strong>Spatial Data Support</strong>:
If <code>df</code> is an <code>sf</code> object from <code><a href="sus_join_spatial.html">sus_join_spatial()</a></code>, geometries are preserved in the output.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Pereira, Rafael H. M.; Barbosa, Rogerio J. (2023) censobr: Download Data from Brazil’s Population Census. R package version v0.4.0, https://CRAN.R-project.org/package=censobr. DOI: 10.32614/CRAN.package.censobr.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">climasus4r</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Prepare spatial health data</span></span>
<span><span class="va">sf_sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="sus_data_import.html">sus_data_import</a></span><span class="op">(</span>uf <span class="op">=</span> <span class="st">"SP"</span>, year <span class="op">=</span> <span class="fl">2023</span>, system <span class="op">=</span> <span class="st">"SIM-DO"</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="sus_data_standardize.html">sus_data_standardize</a></span><span class="op">(</span>lang <span class="op">=</span> <span class="st">"pt"</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="sus_join_spatial.html">sus_join_spatial</a></span><span class="op">(</span>level <span class="op">=</span> <span class="st">"munic"</span>, lang <span class="op">=</span> <span class="st">"pt"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add census population data</span></span>
<span><span class="va">sf_enriched</span> <span class="op">&lt;-</span> <span class="fu">sus_socio_add_census</span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">sf_sim</span>,</span>
<span>  dataset <span class="op">=</span> <span class="st">"population"</span>,</span>
<span>  vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"V0001"</span>, <span class="st">"V0002"</span><span class="op">)</span>,</span>
<span>  year <span class="op">=</span> <span class="fl">2010</span>,</span>
<span>  lang <span class="op">=</span> <span class="st">"pt"</span></span>
<span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="co"># }</span></span></code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Max Anjos, Thaua Menezes.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

